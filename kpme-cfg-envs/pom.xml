<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright 2004-2012 The Kuali Foundation

    Licensed under the Educational Community License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.opensource.org/licenses/ecl2.php

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    
    <modelVersion>4.0.0</modelVersion>
    <groupId>org.kuali.kpme</groupId>
    <artifactId>kpme-cfg-envs</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>
    <name>KPME Configuration Environment Tool</name>
    <url>http://kuali.org/kpme</url>
    <organization>
        <name>The Kuali Foundation</name>
        <url>http://kuali.org</url>
    </organization>
    
    <licenses>
        <license>
            <name>The Kuali Foundation Educational Community License 2.0</name>
            <url>http://www.opensource.org/licenses/ecl2.txt</url>
            <distribution>manual</distribution>
        </license>
    </licenses>
    
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        
        <build.environment>dev</build.environment>
    </properties>
    
    <build>
        <plugins>
            <plugin>
	            <groupId>org.apache.maven.plugins</groupId>
	            <artifactId>maven-scm-plugin</artifactId>
	            <dependencies>
	                <dependency>
	                    <groupId>com.google.code.maven-scm-provider-svnjava</groupId>
	                    <artifactId>maven-scm-provider-svnjava</artifactId>
	                    <version>1.15</version>
	                </dependency>
	            </dependencies>
	            <configuration>
	                <providerImplementations>
	                    <svn>javasvn</svn>
	                </providerImplementations>
	                
	                <scmVersionType>${scmVersionType}</scmVersionType>
	                <scmVersion>${scmVersion}</scmVersion>
	            </configuration>
	            <executions>
	                <execution>
	                    <id>project-checkout</id>
	                    <phase>generate-sources</phase>
	                    <goals>
	                        <goal>checkout</goal>
	                    </goals>
	                    <configuration>
	                        <checkoutDirectory>${project.build.directory}/build</checkoutDirectory>
	                    </configuration>
	                </execution>
	            </executions>
	        </plugin>
        </plugins>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-antrun-plugin</artifactId>
                    <version>1.7</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-invoker-plugin</artifactId>
                    <version>1.6</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-resources-plugin</artifactId>
                    <version>2.5</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-scm-plugin</artifactId>
                    <version>1.6</version>
                </plugin>
                <plugin>
                    <groupId>org.eclipse.m2e</groupId>
                    <artifactId>lifecycle-mapping</artifactId>
                    <version>1.0.0</version>
                    <configuration>
                        <lifecycleMappingMetadata>
                            <pluginExecutions>
                                <pluginExecution>
                                    <pluginExecutionFilter>
                                        <groupId>org.apache.maven.plugins</groupId>
                                        <artifactId>maven-antrun-plugin</artifactId>
                                        <versionRange>[1.0-alpha-1,)</versionRange>
                                        <goals>
                                            <goal>run</goal>
                                        </goals>
                                    </pluginExecutionFilter>
                                    <action>
                                        <ignore />
                                    </action>
                                </pluginExecution>
                                <pluginExecution>
                                    <pluginExecutionFilter>
                                        <groupId>org.apache.maven.plugins</groupId>
                                        <artifactId>maven-scm-plugin</artifactId>
                                        <versionRange>[1.0-alpha-2,)</versionRange>
                                        <goals>
                                            <goal>checkout</goal>
                                        </goals>
                                    </pluginExecutionFilter>
                                    <action>
                                        <ignore />
                                    </action>
                                </pluginExecution>
                                <pluginExecution>
                                    <pluginExecutionFilter>
                                        <groupId>org.kuali.maven.plugins</groupId>
                                        <artifactId>maven-impex-plugin</artifactId>
                                        <versionRange>[1.0.2-SNAPSHOT,)</versionRange>
                                        <goals>
                                            <goal>exportschema</goal>
                                            <goal>exportdata</goal>
                                            <goal>datadtd</goal>
                                            <goal>schemasql</goal>
                                            <goal>datasql</goal>
                                            <goal>reset</goal>
                                            <goal>import</goal>
                                        </goals>
                                    </pluginExecutionFilter>
                                    <action>
                                        <ignore />
                                    </action>
                                </pluginExecution>
                                <pluginExecution>
                                    <pluginExecutionFilter>
                                        <groupId>org.apache.maven.plugins</groupId>
                                        <artifactId>maven-invoker-plugin</artifactId>
                                        <versionRange>[1.0,)</versionRange>
                                        <goals>
                                            <goal>run</goal>
                                        </goals>
                                    </pluginExecutionFilter>
                                    <action>
                                        <ignore />
                                    </action>
                                </pluginExecution>
                            </pluginExecutions>
                        </lifecycleMappingMetadata>
                    </configuration>
                </plugin>
                <plugin>
                    <groupId>org.kuali.maven.plugins</groupId>
                    <artifactId>maven-impex-plugin</artifactId>
                    <version>1.1.0</version>
                    <dependencies>
                        <dependency>
                            <groupId>mysql</groupId>
                            <artifactId>mysql-connector-java</artifactId>
                            <version>5.1.5</version>
                        </dependency>
                    </dependencies>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>
    
    <profiles>
        <profile>
            <id>export</id>
            <build>
                <plugins>
                     <plugin>
                        <groupId>org.kuali.maven.plugins</groupId>
                        <artifactId>maven-impex-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>export-rice</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>exportdata</goal>
                                    <goal>exportschema</goal>
                                    <goal>datadtd</goal>
                                </goals>
                                <configuration>
                                    <artifactId>${kr.dataSource.database}</artifactId>
                                    <dateFormat>yyyyMMddHHmmss</dateFormat>
                                    <driver>${kr.dataSource.driver}</driver>
                                    <url>${kr.dataSource.jdbcUrl}</url>
                                    <username>${kr.dataSource.username}</username>
                                    <password>${kr.dataSource.password}</password>
                                    <outputDir>${project.build.directory}/impex/</outputDir>
                                    <dataXMLDir>${project.build.directory}/impex/${kr.dataSource.database}</dataXMLDir>
                                    <schemaXMLFile>${project.build.directory}/impex/${kr.dataSource.database}.xml</schemaXMLFile>
                                </configuration>
                            </execution>
                            <execution>
                                <id>export-kpme</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>exportdata</goal>
                                    <goal>exportschema</goal>
                                    <goal>datadtd</goal>
                                </goals>
                                <configuration>
                                    <artifactId>${kpme.dataSource.database}</artifactId>
                                    <dateFormat>yyyyMMddHHmmss</dateFormat>
                                    <driver>${kpme.dataSource.driver}</driver>
                                    <url>${kpme.dataSource.jdbcUrl}</url>
                                    <username>${kpme.dataSource.username}</username>
                                    <password>${kpme.dataSource.password}</password>
                                    <outputDir>${project.build.directory}/impex/</outputDir>
                                    <dataXMLDir>${project.build.directory}/impex/${kpme.dataSource.database}</dataXMLDir>
                                    <schemaXMLFile>${project.build.directory}/impex/${kpme.dataSource.database}.xml</schemaXMLFile>
                                </configuration>
                            </execution>
                            <!--
                            <execution>
                                <id>convert-schema-rice-oracle</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>schemasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>oracle</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kr.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kr.dataSource.database}.xml</schemaIncludes>
                                    <outputDir>${project.build.directory}/schema-sql/${kr.dataSource.database}</outputDir>
                                    <runOnlyOnSchemaChange>false</runOnlyOnSchemaChange>
                                </configuration>
                            </execution>
                            -->
                            <execution>
                                <id>convert-schema-rice-mysql</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>schemasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>mysql</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kr.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kr.dataSource.database}.xml</schemaIncludes>
                                    <outputDir>${project.build.directory}/schema-sql/${kr.dataSource.database}</outputDir>
                                    <runOnlyOnSchemaChange>false</runOnlyOnSchemaChange>
                                </configuration>
                            </execution>
                            <!--
                            <execution>
                                <id>convert-schema-kpme-oracle</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>schemasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>oracle</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kpme.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kpme.dataSource.database}.xml</schemaIncludes>
                                    <outputDir>${project.build.directory}/schema-sql/${kpme.dataSource.database}</outputDir>
                                    <runOnlyOnSchemaChange>false</runOnlyOnSchemaChange>
                                </configuration>
                            </execution>
                            -->
                            <execution>
                                <id>convert-schema-kpme-mysql</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>schemasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>mysql</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kpme.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kpme.dataSource.database}.xml</schemaIncludes>
                                    <outputDir>${project.build.directory}/schema-sql/${kpme.dataSource.database}</outputDir>
                                    <runOnlyOnSchemaChange>false</runOnlyOnSchemaChange>
                                </configuration>
                            </execution>
                            <!--
                            <execution>
                                <id>convert-data-rice-oracle</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>datasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>oracle</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kr.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kr.dataSource.database}.xml</schemaIncludes>
                                    <dataXMLDir>${project.build.directory}/impex/${kr.dataSource.database}</dataXMLDir>
                                    <dataXMLExcludes>krsb_qrtz_blob_triggers.xml,krsb_qrtz_calendars.xml,krsb_qrtz_cron_triggers.xml,krsb_qrtz_fired_triggers.xml,krsb_qrtz_job_details.xml,krsb_qrtz_job_listeners.xml,krsb_qrtz_paused_trigger_grps.xml,krsb_qrtz_scheduler_state.xml,krsb_qrtz_simple_triggers.xml,krsb_qrtz_trigger_listeners.xml,krsb_qrtz_triggers.xml,krsb_svc_def_s.xml,krsb_svc_def_t.xml,krsb_svc_dscrptr_s.xml,krsb_svc_dscrptr_t.xml</dataXMLExcludes>
                                    <dataDTD>${project.build.directory}/impex/${kr.dataSource.database}.dtd</dataDTD>
                                    <outputDir>${project.build.directory}/data-sql/${kr.dataSource.database}</outputDir>
                                    <runOnlyOnChange>false</runOnlyOnChange>
                                </configuration>
                            </execution>
                            -->
                            <execution>
                                <id>convert-data-rice-mysql</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>datasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>mysql</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kr.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kr.dataSource.database}.xml</schemaIncludes>
                                    <dataXMLDir>${project.build.directory}/impex/${kr.dataSource.database}</dataXMLDir>
                                    <dataXMLExcludes>krsb_qrtz_blob_triggers.xml,krsb_qrtz_calendars.xml,krsb_qrtz_cron_triggers.xml,krsb_qrtz_fired_triggers.xml,krsb_qrtz_job_details.xml,krsb_qrtz_job_listeners.xml,krsb_qrtz_paused_trigger_grps.xml,krsb_qrtz_scheduler_state.xml,krsb_qrtz_simple_triggers.xml,krsb_qrtz_trigger_listeners.xml,krsb_qrtz_triggers.xml,krsb_svc_def_s.xml,krsb_svc_def_t.xml,krsb_svc_dscrptr_s.xml,krsb_svc_dscrptr_t.xml</dataXMLExcludes>
                                    <dataDTD>${project.build.directory}/impex/${kr.dataSource.database}.dtd</dataDTD>
                                    <outputDir>${project.build.directory}/data-sql/${kr.dataSource.database}</outputDir>
                                    <runOnlyOnChange>false</runOnlyOnChange>
                                </configuration>
                            </execution>
                            <!--
                            <execution>
                                <id>convert-data-kpme-oracle</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>datasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>oracle</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kpme.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kpme.dataSource.database}.xml</schemaIncludes>
                                    <dataXMLDir>${project.build.directory}/impex/${kpme.dataSource.database}</dataXMLDir>
                                    <dataXMLExcludes>qrtz_blob_triggers.xml,qrtz_calendars.xml,qrtz_cron_triggers.xml,qrtz_fired_triggers.xml,qrtz_job_details.xml,qrtz_job_listeners.xml,qrtz_paused_trigger_grps.xml,qrtz_scheduler_state.xml,qrtz_simple_triggers.xml,qrtz_trigger_listeners.xml,qrtz_triggers.xml</dataXMLExcludes>
                                    <dataDTD>${project.build.directory}/impex/${kpme.dataSource.database}.dtd</dataDTD>
                                    <outputDir>${project.build.directory}/data-sql/${kpme.dataSource.database}</outputDir>
                                    <runOnlyOnChange>false</runOnlyOnChange>
                                </configuration>
                            </execution>
                            -->
                            <execution>
                                <id>convert-data-kpme-mysql</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>datasql</goal>
                                </goals>
                                <configuration>
                                    <targetDatabase>mysql</targetDatabase>
                                    <schemaXMLFile>${project.build.directory}/impex/${kpme.dataSource.database}.xml</schemaXMLFile>
                                    <schemaDir>${project.build.directory}/impex</schemaDir>
                                    <schemaIncludes>${kpme.dataSource.database}.xml</schemaIncludes>
                                    <dataXMLDir>${project.build.directory}/impex/${kpme.dataSource.database}</dataXMLDir>
                                    <dataXMLExcludes>qrtz_blob_triggers.xml,qrtz_calendars.xml,qrtz_cron_triggers.xml,qrtz_fired_triggers.xml,qrtz_job_details.xml,qrtz_job_listeners.xml,qrtz_paused_trigger_grps.xml,qrtz_scheduler_state.xml,qrtz_simple_triggers.xml,qrtz_trigger_listeners.xml,qrtz_triggers.xml</dataXMLExcludes>
                                    <dataDTD>${project.build.directory}/impex/${kpme.dataSource.database}.dtd</dataDTD>
                                    <outputDir>${project.build.directory}/data-sql/${kpme.dataSource.database}</outputDir>
                                    <runOnlyOnChange>false</runOnlyOnChange>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>create-scripts-mysql</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <fileset id="mysql-server-schema" file="${project.build.directory}/schema-sql/${kr.dataSource.database}/mysql/${kr.dataSource.database}.sql" />
                                        <fileset id="mysql-server-data" dir="${project.build.directory}/data-sql/${kr.dataSource.database}/mysql" />                                        
                                        <fileset id="mysql-server-constraints" file="${project.build.directory}/schema-sql/${kr.dataSource.database}/mysql/${kr.dataSource.database}-constraints.sql" />
                                        <fileset id="mysql-client-schema" file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/mysql/${kpme.dataSource.database}.sql" />
                                        <fileset id="mysql-client-data" dir="${project.build.directory}/data-sql/${kpme.dataSource.database}/mysql" />
                                        <fileset id="mysql-client-constraints" file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/mysql/${kpme.dataSource.database}-constraints.sql" />
                                        
                                        <pathconvert property="mysql-server-schema-script" refid="mysql-server-schema" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kr.dataSource.database}.sql" to="\. server/schema/schema.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="mysql-server-data-script" refid="mysql-server-data" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <globmapper from="*.sql" to="\. server/data/*.sql" />
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="mysql-server-constraints-script" refid="mysql-server-constraints" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kr.dataSource.database}-constraints.sql" to="\. server/schema/schema-constraints.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="mysql-client-schema-script" refid="mysql-client-schema" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kpme.dataSource.database}.sql" to="\. client/schema/schema.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="mysql-client-data-script" refid="mysql-client-data" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <globmapper from="*.sql" to="\. client/data/*.sql" />
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="mysql-client-constraints-script" refid="mysql-client-constraints" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kpme.dataSource.database}-constraints.sql" to="\. client/schema/schema-constraints.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                                                                
                                        <copy tofile="${project.build.directory}/mysql_${build.environment}/mysql/server/schema/schema.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kr.dataSource.database}/mysql/${kr.dataSource.database}.sql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <copy tofile="${project.build.directory}/mysql_${build.environment}/mysql/server/schema/schema-constraints.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kr.dataSource.database}/mysql/${kr.dataSource.database}-constraints.sql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <copy todir="${project.build.directory}/mysql_${build.environment}/mysql/server/data"> 
                                            <fileset dir="${project.build.directory}/data-sql/${kr.dataSource.database}/mysql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <echo message="${mysql-server-schema-script}${line.separator}${mysql-server-data-script}${line.separator}${mysql-server-constraints-script}" file="${project.build.directory}/mysql_${build.environment}/mysql/mysql_server.sql" /> 
                                        <copy tofile="${project.build.directory}/mysql_${build.environment}/mysql/client/schema/schema.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/mysql/${kpme.dataSource.database}.sql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <copy todir="${project.build.directory}/mysql_${build.environment}/mysql/client/data">
                                            <fileset dir="${project.build.directory}/data-sql/${kpme.dataSource.database}/mysql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <copy tofile="${project.build.directory}/mysql_${build.environment}/mysql/client/schema/schema-constraints.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/mysql/${kpme.dataSource.database}-constraints.sql" />
                                            <filterchain>
                                                <tokenfilter>
                                                    <filetokenizer />
                                                    <replaceregex pattern="^" replace="DELIMITER /${line.separator}" />
                                                    <replaceregex pattern="$" replace="${line.separator}DELIMITER ;" />
                                                </tokenfilter>
                                            </filterchain>
                                        </copy>
                                        <echo message="${mysql-client-schema-script}${line.separator}${mysql-client-data-script}${line.separator}${mysql-client-constraints-script}" file="${project.build.directory}/mysql_${build.environment}/mysql/mysql_client.sql" /> 
                                        
                                        <zip basedir="${project.build.directory}/mysql_${build.environment}" destfile="${project.build.directory}/mysql_${build.environment}.zip" />
                                    </target>
                                </configuration>
                            </execution>
                            <!--
                            <execution>
                                <id>create-scripts-oracle</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <fileset id="oracle-server-schema" file="${project.build.directory}/schema-sql/${kr.dataSource.database}/oracle/${kr.dataSource.database}.sql" />
                                        <fileset id="oracle-server-data" dir="${project.build.directory}/data-sql/${kr.dataSource.database}/oracle" />                                        
                                        <fileset id="oracle-server-constraints" file="${project.build.directory}/schema-sql/${kr.dataSource.database}/oracle/${kr.dataSource.database}-constraints.sql" />
                                        <fileset id="oracle-client-schema" file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/oracle/${kpme.dataSource.database}.sql" />
                                        <fileset id="oracle-client-constraints" file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/oracle/${kpme.dataSource.database}-constraints.sql" />
                                        <fileset id="oracle-client-data" dir="${project.build.directory}/data-sql/${kpme.dataSource.database}/oracle" />
                                        
                                        <pathconvert property="oracle-server-schema-script" refid="oracle-server-schema" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kr.dataSource.database}.sql" to="@server/schema/schema.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="oracle-server-data-script" refid="oracle-server-data" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <globmapper from="*.sql" to="@server/data/*.sql" />
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="oracle-server-constraints-script" refid="oracle-server-constraints" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kr.dataSource.database}-constraints.sql" to="@server/schema/schema-constraints.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="oracle-client-schema-script" refid="oracle-client-schema" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kpme.dataSource.database}.sql" to="@client/schema/schema.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="oracle-client-data-script" refid="oracle-client-data" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <globmapper from="*.sql" to="@client/data/*.sql" />
                                            </chainedmapper>
                                        </pathconvert>
                                        <pathconvert property="oracle-client-constraints-script" refid="oracle-client-constraints" pathsep="${line.separator}">
                                            <chainedmapper>
                                                <flattenmapper />
                                                <filtermapper>
                                                    <replacestring from="${kpme.dataSource.database}-constraints.sql" to="@client/schema/schema-constraints.sql" />
                                                </filtermapper>
                                            </chainedmapper>
                                        </pathconvert>
                                        
                                        <copy tofile="${project.build.directory}/oracle_${build.environment}/oracle/server/schema/schema.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kr.dataSource.database}/oracle/${kr.dataSource.database}.sql" />
                                        </copy>
                                        <copy tofile="${project.build.directory}/oracle_${build.environment}/oracle/server/schema/schema-constraints.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kr.dataSource.database}/oracle/${kr.dataSource.database}-constraints.sql" />
                                        </copy>
                                        <copy todir="${project.build.directory}/oracle_${build.environment}/oracle/server/data"> 
                                            <fileset dir="${project.build.directory}/data-sql/${kr.dataSource.database}/oracle" />
                                        </copy>
                                        <echo message="set sqlblanklines on${line.separator}set define off${line.separator}${oracle-server-schema-script}${line.separator}${oracle-server-data-script}${line.separator}${oracle-server-constraints-script}${line.separator}quit" file="${project.build.directory}/oracle_${build.environment}/oracle/oracle_server.sql" /> 
                                        <copy tofile="${project.build.directory}/oracle_${build.environment}/oracle/client/schema/schema.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/oracle/${kpme.dataSource.database}.sql" />
                                        </copy>
                                        <copy tofile="${project.build.directory}/oracle_${build.environment}/oracle/client/schema/schema-constraints.sql">
                                            <fileset file="${project.build.directory}/schema-sql/${kpme.dataSource.database}/oracle/${kpme.dataSource.database}-constraints.sql" />
                                        </copy>
                                        <copy todir="${project.build.directory}/oracle_${build.environment}/oracle/client/data">
                                            <fileset dir="${project.build.directory}/data-sql/${kpme.dataSource.database}/oracle" />
                                        </copy>
                                        <echo message="set sqlblanklines on${line.separator}set define off${line.separator}${oracle-client-schema-script}${line.separator}${oracle-client-data-script}${line.separator}${oracle-client-constraints-script}${line.separator}quit" file="${project.build.directory}/oracle_${build.environment}/oracle/oracle_client.sql" /> 
                                        
                                        <zip basedir="${project.build.directory}/oracle_${build.environment}" destfile="${project.build.directory}/oracle_${build.environment}.zip" />
                                    </target>
                                </configuration>
                            </execution>
                            -->
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>rebuild</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.kuali.maven.plugins</groupId>
                        <artifactId>maven-impex-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>reset-rice</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>reset</goal>
                                </goals>
                                <configuration>
                                    <artifactId>${admin.dataSource.database}</artifactId>
                                    <driver>${admin.dataSource.driver}</driver>
                                    <url>${admin.dataSource.jdbcUrl}</url>
                                    <username>${admin.dataSource.username}</username>
                                    <password>${admin.dataSource.password}</password>
                                    <serverUrl>${admin.dataSource.jdbcUrl}</serverUrl>
                                    <database>${kr.dataSource.database}</database>
                                    <databaseUser>${kr.dataSource.username}</databaseUser>
                                    <databasePassword>${kr.dataSource.password}</databasePassword>
                                </configuration>
                            </execution>
                            <execution>
                                <id>reset-kpme</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>reset</goal>
                                </goals>
                                <configuration>
                                    <artifactId>${admin.dataSource.database}</artifactId>
                                    <driver>${admin.dataSource.driver}</driver>
                                    <url>${admin.dataSource.jdbcUrl}</url>
                                    <username>${admin.dataSource.username}</username>
                                    <password>${admin.dataSource.password}</password>
                                    <serverUrl>${admin.dataSource.jdbcUrl}</serverUrl>
                                    <database>${kpme.dataSource.database}</database>
                                    <databaseUser>${kpme.dataSource.username}</databaseUser>
                                    <databasePassword>${kpme.dataSource.password}</databasePassword>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
	                    <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-kew</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <copy toDir="${user.home}/kuali/main/${build.environment}/rice/kew/xmlpending">
                                            <fileset dir="${project.build.directory}/build/src/main/config/workflow" />
                                        </copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>deploy</id>
            <build>
                <resources>
                    <resource>
                        <directory>src/main/resources/${build.environment}</directory>
                        <targetPath>${project.build.directory}/environment/${build.environment}</targetPath>
                        <filtering>true</filtering>
                    </resource>
                </resources>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                        <configuration>
                            <useDefaultDelimiters>false</useDefaultDelimiters>
                            <delimiters>
                                <delimiter>@</delimiter>
                            </delimiters>
                        </configuration>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-config</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <copy toDir="${user.home}/kuali/main">
                                            <fileset dir="${project.build.directory}/environment" />
                                        </copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-invoker-plugin</artifactId>
                        <configuration>
                            <streamLogs>true</streamLogs>
                            <projectsDirectory>${project.build.directory}/build</projectsDirectory>
                            <settingsFile>${user.home}/.m2/settings.xml</settingsFile>
                            <pomIncludes>
                                <pomInclude>pom.xml</pomInclude>
                            </pomIncludes>
                            <profiles>
                                <profile>kpme-main</profile>
                                <profile>${build.environment}</profile>
                                <profile>kuali-release</profile>
                            </profiles>
                            <goals>
                                <goal>clean</goal>
                                <goal>pre-site</goal>
                                <goal>package</goal>
                            </goals>
                            <properties>
                                <maven.test.skip>true</maven.test.skip>
                                <decrypt.phase>none</decrypt.phase>
                                <kuali.gpg.phase>none</kuali.gpg.phase>
                            </properties>
                        </configuration>
                        <executions>
                            <execution>
                                <phase>compile</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
    
    <scm>
        <connection>scm:svn:http://svn.kuali.org/repos/kpme/${scmVersionUrl}</connection>
    </scm>
    
    <repositories>
        <repository>
            <id>kuali.nexus</id>
            <name>Nexus Repository Manager</name>
            <url>http://nexus.kuali.org/content/groups/public</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
    </repositories>
    
    <pluginRepositories>
        <pluginRepository>
            <id>kuali.nexus</id>
            <name>Nexus Repository Manager</name>
            <url>http://nexus.kuali.org/content/groups/public</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </pluginRepository>
    </pluginRepositories>

</project>